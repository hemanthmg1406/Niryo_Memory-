<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>3D Force Graph with Card Images</title>
  <script src="https://unpkg.com/three/build/three.min.js"></script>
  <script src="https://unpkg.com/3d-force-graph"></script>
  <style>
    body { margin: 0; overflow: hidden; background-color: #000; }
    #graph-container { width: 100vw; height: 100vh; }
    .tooltip {
      position: absolute;
      pointer-events: none;
      background: #fff;
      padding: 4px;
      border: 1px solid #ccc;
      z-index: 10;
    }
    .tooltip img {
      max-width: 120px;
      height: auto;
      display: block;
    }
  </style>
</head>
<body>
  <div id="graph-container"></div>
  <div class="tooltip" style="display:none;" id="tooltip"></div>
  <script>
    const tooltip = document.getElementById('tooltip');

    const colorMap = new Map();
    let colorIndex = 0;

    const getColorForGroup = (group) => {
      if (!colorMap.has(group)) {
        const hue = (colorIndex * 137.508) % 360; // golden angle
        colorMap.set(group, `hsl(${hue}, 70%, 50%)`);
        colorIndex++;
      }
      return colorMap.get(group);
    };

    fetch('graph_data.json')
      .then(res => res.json())
      .then(data => {
        const groupLinks = [];
        for (let i = 0; i < data.nodes.length; i++) {
          for (let j = i + 1; j < data.nodes.length; j++) {
            if (data.nodes[i].group === data.nodes[j].group) {
              groupLinks.push({ source: data.nodes[i].id, target: data.nodes[j].id });
            }
          }
        }

        const graphData = {
          nodes: data.nodes.map(n => ({
            id: n.id,
            label: n.label,
            group: n.group,
            x: n.x,
            y: n.y,
            z: n.z
          })),
          links: groupLinks
        };

        const Graph = ForceGraph3D()(document.getElementById('graph-container'))
          .graphData(graphData)
          .nodeColor(node => getColorForGroup(node.group))
          .nodeLabel(node => node.label)
          .nodeRelSize(6)
          .linkWidth(() => 1.5)
          .enableNodeDrag(false)
          .enableNavigationControls(true)
          .backgroundColor('#000')
.onNodeHover(node => {
            if (node) {
              tooltip.style.display = 'block';
              tooltip.innerHTML = `<img src="${node.label}" width="100" style="border-radius:8px;" />`;
            } else {
              tooltip.style.display = 'none';
            }
          })
          .enableNodeDrag(false)
          .backgroundColor('#000');

        // Tooltip follows mouse
        window.addEventListener('mousemove', event => {
          tooltip.style.left = (event.clientX + 10) + 'px';
          tooltip.style.top = (event.clientY + 10) + 'px';
        });
      });
  </script>
</body>
</html>
